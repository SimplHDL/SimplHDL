VLOGAN := vlogan
VHDLAN := vhdlan
VCS := vcs
SIMV := ./simv

VLOGAN_FLAGS := -full64
VHDLAN_FLAGS := -full64
VCS_FLAGS := -full64 -licqueue +warn=noLINX_KRNL {{vcs_flags}}
SIMV_FLAGS := -licqueue {{simv_flags}}

include project.mk
-include cocotb.mk

.PHONY: clean compile elaborate simulate gui


simulate: elaborate
	$(SIMV) $(SIMV_FLAGS)


gui: elaborate
	$(SIMV) $(SIMV_FLAGS) -gui


elaborate: compile
	$(VCS) $(VCS_FLAGS) $(TOPLEVELS)


compile: $(VERILOG_FILESETS) $(VHDL_FILESETS)


include dependencies.mk
include *.files


$(LIBRARIES):
	mkdir -p $@


%-vhdl.fileset.com: %-vhdl.fileset %-vhdl.files | $(LIBRARIES)
	$(VHDLAN) $(VHDLAN_FLAGS) -f $<
	@touch $@


%-verilog.fileset.com: %-verilog.fileset %-verilog.files | $(LIBRARIES)
	$(VLOGAN) $(VLOGAN_FLAGS) -f $<
	@touch $@


%-systemverilog.fileset.com: %-systemverilog.fileset %-systemverilog.files | $(LIBRARIES)
	$(VLOGAN) $(VLOGAN_FLAGS) -f $<
	@touch $@


clean:
	rm -rf $(LIBRARIES)
